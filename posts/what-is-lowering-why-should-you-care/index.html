<!doctype html><html lang=en><head><title>What is lowering and why should you care · frikyfriky11</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=color-scheme content="light dark"><meta name=author content="Stefano Previato"><meta name=description content="A brief dive into what lowering your code means for you and for the compiler, and why should you care about it"><meta name=keywords content="blog,developer,personal,software engineer"><meta name=twitter:card content="summary"><meta name=twitter:title content="What is lowering and why should you care"><meta name=twitter:description content="A brief dive into what lowering your code means for you and for the compiler, and why should you care about it"><meta property="og:url" content="https://frikyfriky11.github.io/posts/what-is-lowering-why-should-you-care/"><meta property="og:site_name" content="frikyfriky11"><meta property="og:title" content="What is lowering and why should you care"><meta property="og:description" content="A brief dive into what lowering your code means for you and for the compiler, and why should you care about it"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-09-14T06:57:07+02:00"><meta property="article:modified_time" content="2022-09-14T06:57:07+02:00"><meta property="article:tag" content="Lowering"><meta property="article:tag" content="Compilers"><meta property="article:tag" content="SharpLab"><meta property="article:tag" content="C#"><meta property="article:tag" content="Performance"><meta property="article:tag" content="High Level Language"><link rel=canonical href=https://frikyfriky11.github.io/posts/what-is-lowering-why-should-you-care/><link rel=preload href=/fonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin><link rel=stylesheet href=/css/coder.min.6445a802b9389c9660e1b07b724dcf5718b1065ed2d71b4eeaf981cc7cc5fc46.css integrity="sha256-ZEWoArk4nJZg4bB7ck3PVxixBl7S1xtO6vmBzHzF/EY=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/coder-dark.min.a00e6364bacbc8266ad1cc81230774a1397198f8cfb7bcba29b7d6fcb54ce57f.css integrity="sha256-oA5jZLrLyCZq0cyBIwd0oTlxmPjPt7y6KbfW/LVM5X8=" crossorigin=anonymous media=screen><link rel=icon type=image/svg+xml href=/images/favicon.svg sizes=any><link rel=icon type=image/png href=/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/images/favicon-16x16.png sizes=16x16><link rel=apple-touch-icon href=/images/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/images/safari-pinned-tab.svg color=#5bbad5></head><body class="preload-transitions colorscheme-auto"><div class=float-container><a id=dark-mode-toggle class=colorscheme-toggle><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></a></div><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=https://frikyfriky11.github.io/>frikyfriky11
</a><input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa-solid fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/posts/>Posts</a></li><li class=navigation-item><a class=navigation-link href=/categories/>Categories</a></li><li class=navigation-item><a class=navigation-link href=/tags/>Tags</a></li><li class=navigation-item><a class=navigation-link href=/about/>About me</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=https://frikyfriky11.github.io/posts/what-is-lowering-why-should-you-care/>What is lowering and why should you care</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa-solid fa-calendar" aria-hidden=true></i>
<time datetime=2022-09-14T06:57:07+02:00>September 14, 2022
</time></span><span class=reading-time><i class="fa-solid fa-clock" aria-hidden=true></i>
3-minute read</span></div><div class=authors><i class="fa-solid fa-user" aria-hidden=true></i>
<a href=/authors/stefano-previato/>Stefano Previato</a></div><div class=categories><i class="fa-solid fa-folder" aria-hidden=true></i>
<a href=/categories/c%23/>C#</a>
<span class=separator>•</span>
<a href=/categories/compilers/>Compilers</a></div><div class=tags><i class="fa-solid fa-tag" aria-hidden=true></i>
<span class=tag><a href=/tags/lowering/>Lowering</a>
</span><span class=separator>•</span>
<span class=tag><a href=/tags/compilers/>Compilers</a>
</span><span class=separator>•</span>
<span class=tag><a href=/tags/sharplab/>SharpLab</a>
</span><span class=separator>•</span>
<span class=tag><a href=/tags/c%23/>C#</a>
</span><span class=separator>•</span>
<span class=tag><a href=/tags/performance/>Performance</a>
</span><span class=separator>•</span>
<span class=tag><a href=/tags/high-level-language/>High Level Language</a></span></div></div></header><div class=post-content><p>Nowadays we&rsquo;re all writing highly understandable code (<em>or at least that&rsquo;s what I&rsquo;m telling my coworkers!</em>) in high level languages, almost completely forgetting what those pieces of code are translated to once they are compiled or interpreted.</p><p>Back in the day, people used to punch holes into cards to represent bits as instructions for the CPU, then they invented low level languages, then high level languages, and now we even have high level languages that transpile to other high level languages instead of compiling them (think of TypeScript to JavaScript for example).</p><p>All this preface to say that we&rsquo;re used to write concise pieces of code, usually with the aid of complex constructs hiding underneath a couple of handy keywords (<code>async</code> and <code>await</code> come to mind for example, hiding an entire state machine when you use them) and ignoring how the compiler actually interprets them.</p><p>Speaking of C# for example (since that&rsquo;s the main language I use for work everyday), we are used to constructs such as <code>do ... while</code> or <code>async ... await</code> or even keywords such as <code>record</code> with C# 9.0. This means that we can write something silly like this without much effort:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#66d9ef>int</span> count = <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>do</span> {
</span></span><span style=display:flex><span>    Console.WriteLine(<span style=color:#e6db74>&#34;Hello!&#34;</span>);
</span></span><span style=display:flex><span>    count++;
</span></span><span style=display:flex><span>} <span style=color:#66d9ef>while</span> (count &lt; <span style=color:#ae81ff>3</span>);
</span></span></code></pre></div><p>Ignoring the extreme dumbness of the code (that&rsquo;s not the point of this post), you may think that this is what the C# compiler reads and translates to the Intermediate Language (IL) ready to be run by the JIT compiler, but that&rsquo;s not actually true!</p><p>Before reaching the IL stage of compilation output, C# performs what is called <strong>lowering</strong>.</p><blockquote><p>Lowering consists of, internally, rewriting more complex semantic constructs in terms of simpler ones. For example, while loops and foreach loops can be rewritten in terms of for loops. Then, the rest of the code only has to deal with for loops.
&ndash; Walter Bright, author of the D programming language</p></blockquote><p>As you can see from the definition, C# lowering means taking your code as an input and outputting C# but written in other, simpler terms.</p><p>Recalling the code example above, this is what the C# lowering outputs with that code input:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#66d9ef>int</span> num = <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>while</span> (<span style=color:#66d9ef>true</span>)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    Console.WriteLine(<span style=color:#e6db74>&#34;Hello!&#34;</span>);
</span></span><span style=display:flex><span>    num++;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (num &gt;= <span style=color:#ae81ff>3</span>)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>It may not seem much, but there are a couple of things to note there:</p><ul><li>the variable <code>count</code> has been rewritten into <code>num</code></li><li>the <code>do ... while</code> construct has been replaced with a simpler <code>while (true)</code> construct</li><li>the loop exit condition has been moved inside the loop with an <code>if</code> statement followed by a <code>break</code> keyword</li></ul><p>As you can see, the C# compiler rewrote our code into simpler to understand code, specifically to avoid dealing with more constructs.</p><p>You can see how your code gets lowered with the help of this awesome free tool called <a href=https://sharplab.io/ class=external-link target=_blank rel=noopener>SharpLab</a>. This tool lets you select the C# version you want to compile, the configuration (<em>Debug</em> and <em>Release</em>) to see how the code gets lowered even more, and also lets you see how your code is translated into IL or JIT Asm, for those of you that want to get deeper into how things work at a lower level.</p><p>In the next days I&rsquo;ll post a couple of other nice findings about C# lowering, since I think it&rsquo;s a nice topic to dive into and really brings more clarity in how to write more performant code in general.</p><p>Stay tuned!</p></div><footer></footer></article></section></div><footer class=footer><section class=container>©
2019 -
2025
Stefano Previato
·
Licensed under <a rel=license href=http://creativecommons.org/licenses/by-sa/4.0/>CC BY-SA-4.0</a>
·
Powered by <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/ target=_blank rel=noopener>Coder</a>.</section></footer></main><script src=/js/coder.min.6ae284be93d2d19dad1f02b0039508d9aab3180a12a06dcc71b0b0ef7825a317.js integrity="sha256-auKEvpPS0Z2tHwKwA5UI2aqzGAoSoG3McbCw73gloxc="></script><script type=application/javascript>var _paq=window._paq=window._paq||[];_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),function(){e="https://matomo.frikydesign.it/",_paq.push(["setTrackerUrl",e+"matomo.php"]),_paq.push(["setSiteId","10"]);var e,n=document,t=n.createElement("script"),s=n.getElementsByTagName("script")[0];t.async=!0,t.src=e+"matomo.js",s.parentNode.insertBefore(t,s)}()</script></body></html>